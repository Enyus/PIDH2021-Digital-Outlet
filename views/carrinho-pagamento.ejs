<%- include('./partials/header') %>
    <link rel="stylesheet" href="/stylesheets/carrinho-pagamento.css">

    <main class="carrinho-pagamento">
        <section class="processo-da-compra">
            <div>
                <a class="sacola" href="/carrinho">Sacola</a>
                <a class="identificacao" href="/identificacaocliente">Identificação</a>
                <a class="entrega">Entrega</a>
                <a class="pagamento">Pagamento</a>
            </div>
        </section>

        <div class="container-pagamento">
            <div class="dest-entr-pag">

                <div class="destinatario-entrega">
                    <section class="dados-destinatario">
                        <div class="titulo-div">
                            <div>
                                <h3>Dados do Destinatário</h3>
                                <a href="/identificacaocliente"><img src="/icon/carrinho-editar.png"
                                        alt="edit-destinatario"></a>
                            </div>
                            <p>
                                <%=carrinho.destinatario.nome%>
                                    <%=carrinho.destinatario.sobrenome%>
                            </p>
                        </div>
                        <div class="contato">
                            <p>
                                <%=carrinho.destinatario.email%>
                            </p>
                        </div>
                    </section>
                    <section class="dados-entrega">
                        <div class="titulo-div">
                            <div>
                                <h3>Entrega</h3>
                                <a><img src="/icon/carrinho-editar.png" alt="edit-destinatario"></a>
                            </div>
                        </div>
                        <div class="endereco-entrega">
                            <p>
                                <%= carrinho.entrega.logradouro %>, <%= carrinho.entrega.numero %>
                            </p>
                            <p>
                                <%= carrinho.entrega.cidade %> - <%= carrinho.entrega.estado %>
                            </p>
                            <p>
                                <%= carrinho.entrega.cep %>
                            </p>
                            <div>
                                <p>
                                    <%= carrinho.entrega.modalidadeEntrega %>
                                </p>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="pagamento">
                    <section>
                        <form action="/finalizarpedido" method="post" id="form">
                            <div class="forma-pagamento" id="formapagamento">
                                <p>Formas de pagamento</p>
                                <div>
                                    <input type="radio" name="formapagamento" id="cartaopresente">
                                    <label for="cartaopresente">CARTÃO PRESENTE</label>
                                </div>
                                <div>
                                    <input type="radio" name="formapagamento" id="cartaocredito">
                                    <label for="cartaocredito">CARTÃO DE CRÉDITO</label>
                                </div>
                                <div>
                                    <input type="radio" name="formapagamento" id="pix">
                                    <label for="pix">PIX</label>
                                </div>
                                <div>
                                    <input type="radio" name="formapagamento" id="boleto">
                                    <label for="boleto">BOLETO</label>
                                </div>
                            </div>

                            <div class="dados-pagamento">
                                <p>Dados do cartão</p>
                                <div class="numero-cartao">
                                    <img src="/images/cartões-bandeiras.png" class="img-cartoes"
                                        alt="bandeiras-cartoes">
                                    <label for="numerocartao">Número do Cartão</label>
                                    <input type="text" name="numerocartao" id="numerocartao" required>
                                </div>
                                <div class="parcelamento">
                                    <label for="parcelamento">Parcelamento</label>
                                    <select name="parcelamento" id="parcelamento">
                                        <option value="avista">À vista</option>
                                        <option value="2x">2x s/ juros</option>
                                        <option value="3x">3x s/ juros</option>
                                        <option value="4x">4x s/ juros</option>
                                        <option value="5x">5x s/ juros</option>
                                        <option value="6x">6x s/ juros</option>
                                        <option value="7x">7x s/ juros</option>
                                        <option value="8x">8x s/ juros</option>
                                        <option value="9x">9x s/ juros</option>
                                        <option value="10x">10x s/ juros </option>
                                        <option value="11x">11x s/ juros</option>
                                        <option value="12x">12x s/ juros</option>
                                    </select>
                                </div>
                                <div class="nome-cartao">
                                    <label for="nomecartao">Nome impresso no cartão</label>
                                    <input type="text" name="nomecartao" id="nomecartao">
                                </div>
                                <div class="validade-cartao">
                                    <label for="validadecartao">Validade</label>
                                    <div>
                                        <div class="mes-validade">
                                            <select name="validadecartao" id="validadecartao">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="9">9</option>
                                                <option value="10">10</option>
                                                <option value="11">11</option>
                                                <option value="12">12</option>
                                            </select>
                                        </div>
                                        <p>/</p>
                                        <div class="ano-validade">
                                            <label for="anovalidade"></label>
                                            <select name="anovalidade" id="anovalidade">
                                                <option value="2022">2022</option>
                                                <option value="2023">2023</option>
                                                <option value="2024">2024</option>
                                                <option value="2025">2025</option>
                                                <option value="2026">2026</option>
                                                <option value="2027">2027</option>
                                                <option value="2028">2028</option>
                                                <option value="2029">2029</option>
                                                <option value="2030">2030</option>
                                                <option value="2031">2031</option>
                                                <option value="2032">2032</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="cod-seguranca">
                                    <label for="codseguranca">Código de segurança</label>
                                    <input type="text" name="codseguranca" id="codseguranca">
                                </div>
                                <div class="cpf-titular-cartao">
                                    <label for="cpftitularcartao">CPF do titular</label>
                                    <input type="text" name="cpftitularcartao" id="cpftitularcartao"
                                        placeholder="999.999.999-99">
                                </div>
                            </div>
                            <button type="submit" id="submitpagamento" hidden></button>
                        </form>

                    </section>
                </div>

            </div>

            <section class="resumo">
                <h3 class="resumo">Resumo</h3>
                <div>
                    <table>
                        <% carrinhoDB.forEach( item=> { %>
                            <tr>
                                <td class="img"><img src="<%= item.Fotos[0].urlFoto %>" alt=""></td>
                                <td class="produto">
                                    <h3 class="label">
                                        <%= item.nomeProduto %>
                                    </h3>
                                    <% item.DescTecs.forEach( desctec=> { %>
                                        <% if ( item.DescTecs.findIndex( element=> element.nomeDescTec ==
                                            desctec.nomeDescTec) <= 2) { %>
                                                <div class="tamanho">
                                                    <h4 class="label">
                                                        <%= desctec.nomeDescTec %>:
                                                    </h4>
                                                    <h4 class="dados">
                                                        <%= desctec.valor %>
                                                    </h4>
                                                </div>
                                                <% } %>
                                                    <% }) %>
                                </td>
                                <td>
                                    <h4>R$ <%= (item.preco * (100-item.promocao) / 100).toFixed(2) %>
                                    </h4>
                                </td>
                            </tr>
                            <% }) %>

                    </table>
                </div>
                <div class="total">
                    <div>
                        <p>Subtotal</p>
                        <% let subtotal=0 %>
                            <% carrinhoDB.forEach( item=> { %>
                                <% subtotal +=(item.preco * (100-item.promocao) / 100) *
                                    carrinho.produtos[carrinho.produtos.findIndex( element=> element.idProduto ==
                                    item.idProduto )].quantidade %>
                                    <% }) %>
                                        <p>R$ <%= subtotal.toFixed(2) %>
                                        </p>
                    </div>
                    <div>
                        <p>Taxa de entrega</p>
                        <% let totalFrete=0 %>
                            <% carrinho.produtos.forEach(item=> { %>
                                <% totalFrete +=parseFloat(item.frete) %>
                                    <% }) %>

                                        <% if(totalFrete> 0) { %>
                                            <p>
                                                R$ <%= totalFrete.toFixed(2) %>
                                            </p>
                                            <% } else { %>
                                                <p>-</p>
                                                <% } %>
                    </div>
                    <div class="total">
                        <p>Total</p>
                        <% if(totalFrete> 0) { %>
                            <p>R$ <%= (totalFrete + subtotal).toFixed(2) %>
                            </p>
                            <% } else { %>
                                <p>R$ <%= subtotal.toFixed(2) %>
                                </p>
                                <% } %>
                    </div>
                </div>
                <div>
                    <button class="finalizar-compra" type="submit" id="fakesubmit"
                        onclick="document.getElementById('submitpagamento').click()">FINALIZAR COMPRA</button>
                </div>
            </section>
        </div>
    </main>

    <script src="/scripts/validatePagamento.js"></script>

    <%- include('./partials/footer') %>